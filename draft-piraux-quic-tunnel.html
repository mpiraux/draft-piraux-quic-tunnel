<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Tunneling Internet protocols inside QUIC</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract+p code, #rfc\.abstract+p samp, #rfc\.abstract+p tt {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font-size: 13.5px;
  font-family: Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions and Definitions">
<link href="#rfc.section.3" rel="Chapter" title="3 Reference environment">
<link href="#rfc.section.4" rel="Chapter" title="4 The datagram mode">
<link href="#rfc.section.5" rel="Chapter" title="5 The stream mode">
<link href="#rfc.section.6" rel="Chapter" title="6 TODO(mp): Integrate the following text if needed">
<link href="#rfc.section.7" rel="Chapter" title="7 Benefits of using QUIC">
<link href="#rfc.section.8" rel="Chapter" title="8 Approaches for conveying Internet services">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Packet tunneling">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Transparent proxying">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 One-to-One QUIC tunnel connection">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 N-to-One QUIC tunnel connection">
<link href="#rfc.section.9" rel="Chapter" title="9 Tunneling methods">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Tunneling connection-oriented protocols over QUIC streams">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Tunneling other protocols using DATAGRAM frames">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.26.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Piraux, M., Ed. and O. Bonaventure" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-piraux-quic-tunnel-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-09-06" />
  <meta name="dct.abstract" content="This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows." />
  <meta name="description" content="This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TODO Working Group</td>
<td class="right">M. Piraux, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">O. Bonaventure</td>
</tr>
<tr>
<td class="left">Intended status: Experimental</td>
<td class="right">UCLouvain</td>
</tr>
<tr>
<td class="left">Expires: March 9, 2020</td>
<td class="right">September 06, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Tunneling Internet protocols inside QUIC<br />
  <span class="filename">draft-piraux-quic-tunnel-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 9, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions and Definitions</a>
</li>
<li>3.   <a href="#rfc.section.3">Reference environment</a>
</li>
<li>4.   <a href="#rfc.section.4">The datagram mode</a>
</li>
<li>5.   <a href="#rfc.section.5">The stream mode</a>
</li>
<li>6.   <a href="#rfc.section.6">TODO(mp): Integrate the following text if needed</a>
</li>
<li>7.   <a href="#rfc.section.7">Benefits of using QUIC</a>
</li>
<li>8.   <a href="#rfc.section.8">Approaches for conveying Internet services</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Packet tunneling</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Transparent proxying</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">One-to-One QUIC tunnel connection</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">N-to-One QUIC tunnel connection</a>
</li>
</ul><li>9.   <a href="#rfc.section.9">Tunneling methods</a>
</li>
<ul><li>9.1.   <a href="#rfc.section.9.1">Tunneling connection-oriented protocols over QUIC streams</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Tunneling other protocols using DATAGRAM frames</a>
</li>
</ul><li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<ul><li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Mobile devices such as laptops, smartphones or tablets have different requirements than the traditional fixed devices. These mobile devices often change their network attachment. They are often attached to trusted networks, but sometimes they need to be connected to untrusted networks where their communications can be eavesdropped, filtered or modified. In these situations, the classical approach is to rely on VPN protocols such as DTLS, TLS or IPSec. These VPN protocols provide the encryption and authentication functions to protect those mobile clients from malicious behaviors in untrusted networks.</p>
<p id="rfc.section.1.p.2">On the other hand, these devices are often multihomed and many expect to be able to perform seamless handovers from one access network to another without breaking the established VPN sessions. In some situations it can also be beneficial to combine two or more access networks together to increase the available host bandwidth. A protocol such as Multipath TCP supports those handovers and allows to aggregate the bandwidth of different access links. It could be combined with single-path VPN protocols to support both seamless handovers and bandwidth aggregation above VPN tunnels. Unfortunately, Multipath is not yet deployed on most Internet servers and thus few applications would benefit from such a use case.</p>
<p id="rfc.section.1.p.3">The QUIC protocol opens up a new way to find a clean solution to this problem. First, QUIC includes the same encryption and authentication techniques as deployed VPN protocols. Second, QUIC is intended to be widely used to support web-based services, making it unlikely to be filtered in many networks, in contrast with VPN protocols. Third, the multipath extensions proposed for QUIC enable it to efficiently support both seamless handovers and bandwidth aggregation.</p>
<p id="rfc.section.1.p.4">In this document, we explore how (Multipath) QUIC could be used to enable multipath mobile devices to communicate securely in untrusted networks. More precisely, we explore and compare two different designs.  The first, section <a href="#the-datagram-mode" class="xref">Section 4</a>, uses the recently proposed datagram extension for QUIC to transport plain IP packets over a Multipath QUIC connection. The second, section <a href="#the-stream-mode" class="xref">Section 5</a>, uses the QUIC streams to transport TCP bytestreams over a Multipath QUIC connection.</p>
<p id="rfc.section.1.p.5">Our starting point for this work is Multipath QUIC that was initially proposed in <a href="#CoNEXT" class="xref">[CoNEXT]</a>. A detailed specification of Multipath QUIC may be found in <a href="#I-D.deconinck-quic-multipath" class="xref">[I-D.deconinck-quic-multipath]</a>. Two implementations of different version of this protocol are available <a href="#CoNEXT" class="xref">[CoNEXT]</a>, <a href="#SIGCOMM19" class="xref">[SIGCOMM19]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#conventions-and-definitions" id="conventions-and-definitions">Conventions and Definitions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#reference-environment" id="reference-environment">Reference environment</a>
</h1>
<p id="rfc.section.3.p.1">We consider a multihomed client that establishes a Multipath QUIC connection to a concentrator. Once the connection has been established, it is used to carry all the data traffic sent by the client. The Multipath QUIC connection ensures that the client data is protected against attacks in one or both of the access networks. The client trusts the concentrator. The concentrator decrypts the frames exchanged over the Multipath QUIC connection and interacts with the remote hosts as a VPN concentrator would do.</p>
<div id="rfc.figure.1"></div>
<div id="fig-reference-environment"></div>
<pre>
            +---------+
       .----| Access  |----.
       |    | network |    |
       |    |    A    |    |
+--------+  +----------    v                          +-------------+
| Multi  |              +--------------+              | Final       |
| homed  |              | Concentrator |===\ ... \===&gt;| destination |
| client |              +--------------+              | server      |
+--------+  +---------+    ^                          +-------------+
       |    | Access  |    |
       |    | network |    |            Legend:
       .----|    B    |----.              --- Multipath QUIC subflow
            +---------+                   === Original tunneled flow
</pre>
<p class="figure">Figure 1: Reference environment</p>
<p id="rfc.section.3.p.2">TODO(mp): The figure illustrate the client to server connection example, but not the reverse</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#the-datagram-mode" id="the-datagram-mode">The datagram mode</a>
</h1>
<p id="rfc.section.4.p.1">Our first mode of operation, called the datagram mode in this document, enables the client and the concentrator exchange raw IP packets through the Multipath QUIC connection. This is done by using the recently proposed QUIC datagram extension <a href="#I-D.pauly-quic-datagram" class="xref">[I-D.pauly-quic-datagram]</a>.  In a nutshell, to send an IP packet to a remote host, the client simply passes the entire packet as a datagram to the Multipath QUIC connection established with the concentrator. The packet is encoded in a QUIC frame, then encrypted and authenticated in a QUIC packet. This transmission is subject to congestion control, but the datagram that contains the packet is not retransmitted in case of losses as specified in <a href="#I-D.pauly-quic-datagram" class="xref">[I-D.pauly-quic-datagram]</a>.</p>
<p id="rfc.section.4.p.2">The datagram mode is intended to provide a similar service as the one provided by IPSec tunnels or DTLS.</p>
<p id="rfc.section.4.p.3">TODO(ob): Maybe look at MTU issues, because those will appear</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#the-stream-mode" id="the-stream-mode">The stream mode</a>
</h1>
<p id="rfc.section.5.p.1">The main advantage of the datagram mode is that it supports IP and any protocol above the network layer. Any IP packet can be transported using the datagram extension over a Multipath QUIC connection. However, this advantage comes with a large per-packet overhead since each packet contains a network and a transport header. All these headers must be transmitted in addition with the IP/UDP/QUIC headers of the Multipath QUIC connection. For TCP connections, the overhead can be large.</p>
<p id="rfc.section.5.p.2">Since QUIC support multiple parallel streams, another possibility to carry TCP connections between the client and the concentrator is to transport the bytestream of each connection as one of the streams of the Multipath QUIC connection. For this, we base our approach on the 0-RTT Converter protocol (<a href="#I-D.ietf-tcpm-converters" class="xref">[I-D.ietf-tcpm-converters]</a>) that was proposed to each the deployment of TCP extensions. In a nutshell, it is an application proxy that converts TCP connections, allowing the use of new TCP extensions while avoiding inducing extra delay in the process.</p>
<p id="rfc.section.5.p.3">We use a similar approach in our stream mode. When a client (or the concentrator) opens a stream, it sends at the beginning of the bytestream a series of TLV messages that indicate the IP address and port number of the remote destination of the bytestream. Upon reception of these TLV messages, the concentrator (or the client) opens a TCP connection towards the specified destination and connects the incoming bytestream of the Multipath QUIC connection to the bytestream of the new TCP connection (and similarly in the opposite direction).  <a href="#tcp-proxy-stream" class="xref">Figure 2</a> summarizes how the new TCP connection is mapped to the QUIC stream.</p>
<div id="rfc.figure.2"></div>
<div id="tcp-proxy-stream"></div>
<pre>
+------------------+-------------------------+
|        TCP       |      QUIC Stream        |
+------------------+-------------------------+
| SYN received     | Open Stream, send TLVs  |
| FIN received     | Send Stream FIN         |
| RST received     | Send STOP_SENDING       |
|                  | Send RESET_STREAM       |
| Data received    | Send Stream data        |
+------------------+-------------------------+

+-------------------------------+------------+
|         QUIC Stream           |    TCP     |
+-------------------------------+------------+
| Stream opened, TLVs received  | Send SYN   |
| Stream FIN received           | Send FIN   |
| STOP_SENDING received         | Send RST   |
| RESET_STREAM received         | Send RST   |
| Stream data received          | Send data  |
+-------------------------------+------------+
</pre>
<p class="figure">Figure 2: TCP connection to QUIC stream mapping</p>
<p id="rfc.section.5.p.4">Actions and events of the TCP state machine are mapped to the QUIC stream state machine as illustrated in <a href="#tcp-proxy-stream" class="xref">Figure 2</a>.</p>
<p id="rfc.section.5.p.5">The QUIC stream-level flow control can be tuned to match the terminated TCP connection receive window size, so that no excessive amount of data is buffered inside the tunnel.</p>
<p id="rfc.section.5.p.6">A timeout can be associated with a given mapped QUIC stream for its associated state to expire when the TCP connection is inactive for a long period.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#todomp-integrate-the-following-text-if-needed" id="todomp-integrate-the-following-text-if-needed">TODO(mp): Integrate the following text if needed</a>
</h1>
<p id="rfc.section.6.p.1">TODO(mp): The 1-to-1 vs N-to-1 paragraphs are interesting imo.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#benefits-of-using-quic" id="benefits-of-using-quic">Benefits of using QUIC</a>
</h1>
<p id="rfc.section.7.p.1">QUIC introduces several new features to the transport layer. Being able to tunnel Internet services into QUIC offers a smooth upgrade path for legacy applications.  In the context of a QUIC tunnel operating in the use cases presented in .., those applications can benefit from several features.</p>
<p id="rfc.section.7.p.2">The additional QUIC encryption layer masks the conveyed protocols and prevent, up to a certain degree, their pervasive monitoring. Zero RTT QUIC connection establishment allows the tunnel to be established without impacting the conveyed service latency. QUIC connection migration allows decoupling the conveyed Internet service from the network layer. For instance, tunneled TCP flows can be migrated from a 5G base station to another by migrating the QUIC tunnel connection.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#approaches-for-conveying-internet-services" id="approaches-for-conveying-internet-services">Approaches for conveying Internet services</a>
</h1>
<p id="rfc.section.8.p.1">Several directions can be taken when tunneling Internet services. First, we consider the scope of the QUIC tunnel, i.e. at the service connection level (<a href="#transparent-proxy" class="xref">Section 8.2</a>) or at the service packet level (<a href="#packet-tunneling" class="xref">Section 8.1</a>).  Second, we consider whether only a single Internet service can be conveyed in a QUIC tunnel or whether multiple services can share the same QUIC tunnel connection (<a href="#one-to-one" class="xref">Section 8.3</a> and <a href="#n-to-one" class="xref">Section 8.4</a>).</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#packet-tunneling" id="packet-tunneling">Packet tunneling</a>
</h1>
<p id="rfc.section.8.1.p.1">Packet tunneling is the traditional approach used by many VPNs and tunnels.  In this approach, each Internet protocol is considered on a per-packet basis. The packets are fully preserved when sent and received through the tunnel.</p>
<p id="rfc.section.8.1.p.2">This approach respects the end-to-end principle and thus does not introduce ossification. New transport protocols extensions can be negotiated in an end-to-end manner.</p>
<p id="rfc.section.8.1.p.3">This approach results in a higher encapsulation overhead, but it can be mitigated using advanced header compression techniques such as ROHC (<a href="#RFC3095" class="xref">[RFC3095]</a>) and SHCH (<a href="#I-D.ietf-lpwan-ipv6-static-context-hc" class="xref">[I-D.ietf-lpwan-ipv6-static-context-hc]</a>).</p>
<p id="rfc.section.8.1.p.4">Reliable Internet services require the QUIC connection to adapt, i.e. to transport their packets unreliably. Layering reliable transport protocols leads to the well-known meltdown problem in which the retransmissions mechanism of the different layers can severely interfere with each other.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#transparent-proxy" id="transparent-proxy">Transparent proxying</a>
</h1>
<p id="rfc.section.8.2.p.1">As QUIC offers a reliable and in-order bytestream service, a connection-oriented, non-authenticated, transport protocol could be terminated by the tunnel and proxied over QUIC. Its bytestream can then be sent over a QUIC stream. The QUIC stream must start with a special header indicating the original destination and could contain other protocol-specific control data.  For instance, proxying a TCP connection requires to indicate the destination address and port.</p>
<p id="rfc.section.8.2.p.2">This approach has advantages and drawbacks. On the one hand, by terminating the connection closer the user, it can be established rapidly and losses in the access networks can be quickly detected and recovered from. It also lowers the encapsulation overhead by only including a small header before the bytestream.</p>
<p id="rfc.section.8.2.p.3">On the other hand, terminating a transport protocol connection breaks the end-to-end principle. It introduces ossification in the network and slows down the deployment of new transport protocols and extensions.</p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> <a href="#one-to-one" id="one-to-one">One-to-One QUIC tunnel connection</a>
</h1>
<p id="rfc.section.8.3.p.1">The simplest approach when conveying an Internet service over QUIC would be to map a single connection to a single QUIC connection. This approach does not take advantage of the multiples streams and out-of-order packet processing features of QUIC.</p>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> <a href="#n-to-one" id="n-to-one">N-to-One QUIC tunnel connection</a>
</h1>
<p id="rfc.section.8.4.p.1">When a client is using many Internet services through the QUIC tunnel, one could convey several of them inside a single QUIC connection. By leveraging the multiple streams feature of QUIC, this approach reduces the fixed cost of establishing and using a QUIC connection.</p>
<p id="rfc.section.8.4.p.2">Moreover, bundling several Internet connections inside a QUIC connection provides a more global point of view on the client network performances. It allows to take more informed decisions during packet scheduling or congestion control.</p>
<p id="rfc.section.8.4.p.3">TODO(mp): The preceding paragraph is not clear</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#tunneling-methods" id="tunneling-methods">Tunneling methods</a>
</h1>
<p id="rfc.section.9.p.1">Internet services rely on several protocols. In this section we present a flexible method to tunnel the most ubiquitous ones.</p>
<p id="rfc.section.9.p.2">QUIC version 1 provides reliable and in-order bytestreams in the form of QUIC streams, which can be either unidirectional or bidirectional. An alternative view of QUIC unidirectional streams is an elastic message.  In addition, the DATAGRAM extension <a href="#I-D.pauly-quic-datagram" class="xref">[I-D.pauly-quic-datagram]</a> provide a datagram mode for QUIC in the form of DATAGRAM frames. They are simple unreliable messages that must fit the size of a QUIC packet.</p>
<p id="rfc.section.9.p.3">In the following sections, we explain how connection-oriented protocols can benefit from QUIC streams and how other protocols can be conveyed using DATAGRAM frames.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#tunneling-connection-oriented-protocols-over-quic-streams" id="tunneling-connection-oriented-protocols-over-quic-streams">Tunneling connection-oriented protocols over QUIC streams</a>
</h1>
<p id="rfc.section.9.1.p.1">In this sub-section, we explain a method for proxying and conveying non-authenticated, connection-oriented protocols such as TCP over a QUIC tunnel.  When terminating a connection, additional informations must be provided in order for the other peer to create a new connection to the final destination.  For instance, proxying a TCP connection requires to communicate the destination address and port to use.</p>
<p id="rfc.section.9.1.p.2">To this effect, we propose a flexible format to encode protocol header fields.  This protocol can be used specify header fields for IPv4 and IPv6 as well as any IP protocols.</p>
<p id="rfc.section.9.1.p.3">TODO(mp): Rephrase so that it's clear we mean protocols running above IP, not new IP protocols</p>
<div id="rfc.figure.3"></div>
<div id="quic-tunnel-headers-block"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Fields (8)  |              [Header Fields (*)]            ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 3: QUIC Tunnel Headers Block</p>
<p id="rfc.section.9.1.p.4">A number of header fields can be sent using an Headers Block as illustrated in <a href="#quic-tunnel-headers-block" class="xref">Figure 3</a>. Those header fields allow exchanging fields of the network and transport header used by the terminated connection. A Headers Block can be placed at the beginning of the QUIC stream and followed by the connection bytestream.</p>
<p id="rfc.section.9.1.p.5">It consists of the following fields:</p>
<p></p>

<dl>
<dt>Fields:</dt>
<dd style="margin-left: 8">A 8-bit value indicating the number of Header Fields in the Headers Block.</dd>
<dt>Header Fields:</dt>
<dd style="margin-left: 8">A sequence of Header Field.</dd>
</dl>
<div id="rfc.figure.4"></div>
<div id="quic-tunnel-header-block"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| IP Next Hdr(8)|                  Field ID (i)               ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Length (i)                        ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Value (*)                        ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 4: QUIC Tunnel Header Field</p>
<p id="rfc.section.9.1.p.7">An Header Field consists of four fields:</p>
<p></p>

<dl>
<dt>IP Next Hdr:</dt>
<dd style="margin-left: 8">A Internet Protocol number designating the protocol which this header field is part of.</dd>
</dl>
<p id="rfc.section.9.1.p.9">TODO(mp): How to represent IPv4 and v6 ? 0x04 (IP in IP) and 0x29 (IPv6 Encapsulation) ?</p>
<p></p>

<dl>
<dt>Field ID:</dt>
<dd style="margin-left: 8">A varint-encoded number designating the particular field in the protocol. The field is identified by its relative position in the header. For instance, The first field is represented by the value 0, the second by the value 1.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">The length of the Value field is varint-encoded in the Length field.</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">The field value bytes are placed at the end of the Header Field.</dd>
</dl>
<p id="rfc.section.9.1.p.11">TODO(mp): What is the implication of not maintaining IP connectivity, with for instance FTP or others ?</p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#tunneling-other-protocols-using-datagram-frames" id="tunneling-other-protocols-using-datagram-frames">Tunneling other protocols using DATAGRAM frames</a>
</h1>
<p id="rfc.section.9.2.p.1">The unreliable message service provided by DATAGRAM frames allows tunneling other protocols over QUIC. It can also benefit to connection-oriented protocols that can be conveyed on a per-packet basis in an end-to-end manner and thus without introducing ossification. We discuss both cases in this subsection.</p>
<p id="rfc.section.9.2.p.2">We propose to convey unreliable protocols, e.g. IP and UDP, over a flow of DATAGRAM frames. Each tunneled packet could be conveyed over QUIC unidirectional streams but this adds un-necessary complexity in the form of retransmissions and stream state handling.</p>
<p id="rfc.section.9.2.p.3">Similarly, we propose to convey reliable transport protocols on a per-packet basis over DATAGRAM frames. Using QUIC unidirectional streams has the same disadvantages. Moreover, the layering of retransmissions mechanisms could lead to the <em>TCP meltdown</em> problem.</p>
<p id="rfc.section.9.2.p.4">Each packet of a tunneled flow is encapsulated inside the payload of a DATAGRAM frame. We consider each packet as starting from the network layer, such that the packet can then be forwarded at the exit of the QUIC Tunnel. The QUIC Tunnel must be able to advertise the correct MTU for the flows entering the tunnel to adapt their packet sizes.</p>
<p id="rfc.section.9.2.p.5">TODO(mp): This implies several assumptions on the client address and the tunnel placement in the network.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">TODO Security</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.11.p.1">This document has no IANA actions.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="CoNEXT">[CoNEXT]</b></td>
<td class="top">
<a>De Coninck, Q.</a> and <a>O. Bonaventure</a>, "<a>Multipath QUIC: Design and Evaluation</a>", Proceedings of the 13th International Conference on emerging Networking EXperiments and Technologies (CoNEXT 2017) , December 2017.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.deconinck-quic-multipath">[I-D.deconinck-quic-multipath]</b></td>
<td class="top">
<a>Coninck, Q.</a> and <a>O. Bonaventure</a>, "<a href="https://tools.ietf.org/html/draft-deconinck-quic-multipath-03">Multipath Extensions for QUIC (MP-QUIC)</a>", Internet-Draft draft-deconinck-quic-multipath-03, August 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-lpwan-ipv6-static-context-hc">[I-D.ietf-lpwan-ipv6-static-context-hc]</b></td>
<td class="top">
<a>Minaburo, A.</a>, <a>Toutain, L.</a>, <a>Gomez, C.</a>, <a>Barthel, D.</a> and <a>J. Zuniga</a>, "<a href="https://tools.ietf.org/html/draft-ietf-lpwan-ipv6-static-context-hc-21">Static Context Header Compression (SCHC) and fragmentation for LPWAN, application to UDP/IPv6</a>", Internet-Draft draft-ietf-lpwan-ipv6-static-context-hc-21, July 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-tcpm-converters">[I-D.ietf-tcpm-converters]</b></td>
<td class="top">
<a>Bonaventure, O.</a>, <a>Boucadair, M.</a>, <a>Gundavelli, S.</a>, <a>Seo, S.</a> and <a>B. Hesmans</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tcpm-converters-12">0-RTT TCP Convert Protocol</a>", Internet-Draft draft-ietf-tcpm-converters-12, October 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.pauly-quic-datagram">[I-D.pauly-quic-datagram]</b></td>
<td class="top">
<a>Pauly, T.</a>, <a>Kinnear, E.</a> and <a>D. Schinazi</a>, "<a href="https://tools.ietf.org/html/draft-pauly-quic-datagram-03">An Unreliable Datagram Extension to QUIC</a>", Internet-Draft draft-pauly-quic-datagram-03, July 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3095">[RFC3095]</b></td>
<td class="top">
<a>Bormann, C.</a>, <a>Burmeister, C.</a>, <a>Degermark, M.</a>, <a>Fukushima, H.</a>, <a>Hannu, H.</a>, <a>Jonsson, L-E.</a>, <a>Hakenberg, R.</a>, <a>Koren, T.</a>, <a>Le, K.</a>, <a>Liu, Z.</a>, <a>Martensson, A.</a>, <a>Miyazaki, A.</a>, <a>Svanbro, K.</a>, <a>Wiebke, T.</a>, <a>Yoshimura, T.</a> and <a>H. Zheng</a>, "<a href="https://tools.ietf.org/html/rfc3095">RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed</a>", RFC 3095, DOI 10.17487/RFC3095, July 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3843">[RFC3843]</b></td>
<td class="top">
<a>Jonsson, L-E.</a> and <a>G. Pelletier</a>, "<a href="https://tools.ietf.org/html/rfc3843">RObust Header Compression (ROHC): A Compression Profile for IP</a>", RFC 3843, DOI 10.17487/RFC3843, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4019">[RFC4019]</b></td>
<td class="top">
<a>Pelletier, G.</a>, "<a href="https://tools.ietf.org/html/rfc4019">RObust Header Compression (ROHC): Profiles for User Datagram Protocol (UDP) Lite</a>", RFC 4019, DOI 10.17487/RFC4019, April 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4815">[RFC4815]</b></td>
<td class="top">
<a>Jonsson, L-E.</a>, <a>Sandlund, K.</a>, <a>Pelletier, G.</a> and <a>P. Kremer</a>, "<a href="https://tools.ietf.org/html/rfc4815">RObust Header Compression (ROHC): Corrections and Clarifications to RFC 3095</a>", RFC 4815, DOI 10.17487/RFC4815, February 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6846">[RFC6846]</b></td>
<td class="top">
<a>Pelletier, G.</a>, <a>Sandlund, K.</a>, <a>Jonsson, L-E.</a> and <a>M. West</a>, "<a href="https://tools.ietf.org/html/rfc6846">RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP)</a>", RFC 6846, DOI 10.17487/RFC6846, January 2013.</td>
</tr>
<tr>
<td class="reference"><b id="SIGCOMM19">[SIGCOMM19]</b></td>
<td class="top">
<a>De Coninck, Q.</a>, <a>Michel, F.</a>, <a>Piraux, M.</a>, <a>Given-Wilson, T.</a>, <a>Legay, A.</a>, <a>Pereira, O.</a> and <a>O. Bonaventure</a>, "<a>Pluginizing QUIC</a>", Proceedings of the ACM Special Interest Group on Data Communication , August 2019.</td>
</tr>
</tbody></table>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.A.p.1">TODO acknowledge.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maxime Piraux</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Piraux</span>
	  </span>
	</span>
	<span class="org vcardline">UCLouvain</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maxime.piraux@uclouvain.be">maxime.piraux@uclouvain.be</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Olivier Bonaventure</span> 
	  <span class="n hidden">
		<span class="family-name">Bonaventure</span>
	  </span>
	</span>
	<span class="org vcardline">UCLouvain</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:olivier.bonaventure@uclouvain.be">olivier.bonaventure@uclouvain.be</a></span>

  </address>
</div>

</body>
</html>

