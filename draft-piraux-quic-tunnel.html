<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Tunneling Internet protocols inside QUIC</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract+p code, #rfc\.abstract+p samp, #rfc\.abstract+p tt {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font-size: 13.5px;
  font-family: Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions and Definitions">
<link href="#rfc.section.3" rel="Chapter" title="3 Use cases">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Multiple access networks in 5G networks">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Hybrid access networks for residential gateways">
<link href="#rfc.section.4" rel="Chapter" title="4 Benefits of using QUIC">
<link href="#rfc.section.5" rel="Chapter" title="5 Approaches for conveying Internet services">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Transparent proxying">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Packet tunneling">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 One-to-One QUIC tunnel connection">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 N-to-One QUIC tunnel connection">
<link href="#rfc.section.6" rel="Chapter" title="6 Tunneling methods">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Transport layer tunneling">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Tunneling TCP connections">
<link href="#rfc.section.6.2.1" rel="Chapter" title="6.2.1 TCP to QUIC stream mapping">
<link href="#rfc.section.6.2.2" rel="Chapter" title="6.2.2 TCP segments tunneling">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Tunneling UDP flows">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Tunneling QUIC connections">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Tunneling IP flows">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.26.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Piraux, M., Ed. and O. Bonaventure" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-piraux-quic-tunnel-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-09-06" />
  <meta name="dct.abstract" content="This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows." />
  <meta name="description" content="This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TODO Working Group</td>
<td class="right">M. Piraux, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">O. Bonaventure</td>
</tr>
<tr>
<td class="left">Intended status: Experimental</td>
<td class="right">UCLouvain</td>
</tr>
<tr>
<td class="left">Expires: March 9, 2020</td>
<td class="right">September 06, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Tunneling Internet protocols inside QUIC<br />
  <span class="filename">draft-piraux-quic-tunnel-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 9, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions and Definitions</a>
</li>
<li>3.   <a href="#rfc.section.3">Use cases</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Multiple access networks in 5G networks</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Hybrid access networks for residential gateways</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Benefits of using QUIC</a>
</li>
<li>5.   <a href="#rfc.section.5">Approaches for conveying Internet services</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Transparent proxying</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Packet tunneling</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">One-to-One QUIC tunnel connection</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">N-to-One QUIC tunnel connection</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Tunneling methods</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Transport layer tunneling</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Tunneling TCP connections</a>
</li>
<ul><li>6.2.1.   <a href="#rfc.section.6.2.1">TCP to QUIC stream mapping</a>
</li>
<li>6.2.2.   <a href="#rfc.section.6.2.2">TCP segments tunneling</a>
</li>
</ul><li>6.3.   <a href="#rfc.section.6.3">Tunneling UDP flows</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Tunneling QUIC connections</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">Tunneling IP flows</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Access networks evolve rapidly. 5G access networks and hybrid access networks are two examples of their constant evolution. These networks claim to offer more performance to the users, but they first require the transport layer to adapt. On the one hand, experience with the deployment of TCP extensions showed that new extensions can take years to get wide adoption. On the other hand, experience with SCTP showed that deploying a new transport protocol is hard (rephrase).</p>
<p id="rfc.section.1.p.2">As a result, small and medium size network application developers teams rarely revisit their choice in terms of transport layer uses. Moreover, transport protocols are usually implemented in the kernel and are used through API abstractions, which slows down the innovation in this layer. To benefit from those new access networks, applications developers have to wait for kernel developers to implement the required extensions and then they have to update their own applications.</p>
<p id="rfc.section.1.p.3">QUIC has been designed as an userspace transport protocol atop UDP to address some of these issues. It also brings new features that can leverage these new access networks, such as connection migration. Its built-in and extensive encryption combined with its clean extensibility model brings back innovation in the transport layer. But application developers still have to update their application to benefit from QUIC.</p>
<p id="rfc.section.1.p.4">Using a QUIC tunnel to transparently convey Internet services accross those new access networks provides a smooth upgrade-path for legacy application. In this document, we specifies methods for tunneling Internet protocols inside a QUIC connection, including TCP, UDP, IP and QUIC flows.</p>
<p id="rfc.section.1.p.5">TODO Introduction</p>
<p id="rfc.section.1.p.6">TODO Motivate the need of a proxy (e.g. in 4G/5G, in hybrid network access) to provide a smooth upgrade-path for legacy applications</p>
<p id="rfc.section.1.p.7">TODO Introduce QUIC</p>
<p id="rfc.section.1.p.8">TODO Introduce Multipath QUIC</p>
<p id="rfc.section.1.p.9">TODO Layout the document organisation</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#conventions-and-definitions" id="conventions-and-definitions">Conventions and Definitions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#use-cases" id="use-cases">Use cases</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#multiple-access-networks-in-5g-networks" id="multiple-access-networks-in-5g-networks">Multiple access networks in 5G networks</a>
</h1>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#hybrid-access-networks-for-residential-gateways" id="hybrid-access-networks-for-residential-gateways">Hybrid access networks for residential gateways</a>
</h1>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#benefits-of-using-quic" id="benefits-of-using-quic">Benefits of using QUIC</a>
</h1>
<p id="rfc.section.4.p.1">QUIC introduces several new features to the transport layer. Being able to tunnel Internet services into QUIC offers a smooth upgrade path for legacy applications.  In the context of a QUIC tunnel operating in the use cases presented in <a href="#use-cases" class="xref">Section 3</a>, those applications can benefit from several features.</p>
<p id="rfc.section.4.p.2">The additional QUIC encryption layer masks the conveyed protocols and prevent, up to a certain degree, their pervasive monitoring. Zero RTT QUIC connection establishment allows the tunnel to be established without impacting the conveyed service latency. QUIC connection migration allows decoupling the conveyed Internet service from the network layer. For instance, tunneled TCP flows can be migrated from a 5G base station to another by migrating the QUIC tunnel connection.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#approaches-for-conveying-internet-services" id="approaches-for-conveying-internet-services">Approaches for conveying Internet services</a>
</h1>
<p id="rfc.section.5.p.1">Several directions can be taken when tunneling Internet services. First, we consider the scope of the QUIC tunnel, i.e. at the service connection level (<a href="#transparent-proxy" class="xref">Section 5.1</a>) or at the service packet level (<a href="#packet-tunneling" class="xref">Section 5.2</a>).  Second, we consider whether only a single Internet service can be conveyed in a QUIC tunnel or whether multiple services can share the same QUIC tunnel connection (<a href="#one-to-one" class="xref">Section 5.3</a> and <a href="#n-to-one" class="xref">Section 5.4</a>).</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#transparent-proxy" id="transparent-proxy">Transparent proxying</a>
</h1>
<p id="rfc.section.5.1.p.1">As QUIC offers a reliable and in-order bytestream service, one could proxy and terminate a TCP connection. Its data can then be sent over a QUIC stream.  The QUIC stream must start with a special header indicating the TCP original destination.</p>
<p id="rfc.section.5.1.p.2">This approach has advantages and drawbacks. On the one hand, by terminating the connection closer the user, it can be established rapidly and the losses in the access networks can be quickly detected and recovered from. It also lowers the encapsulation overhead by only including a small header before the bytestream.</p>
<p id="rfc.section.5.1.p.3">On the other hand, terminating the TCP connection breaks the end-to-end principle. It introduces ossification in the network and slows down the deployment of new TCP extensions.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#packet-tunneling" id="packet-tunneling">Packet tunneling</a>
</h1>
<p id="rfc.section.5.2.p.1">Packet tunneling is the traditional approach used by many VPNs and tunnels.  In this approach, each Internet protocol is only considered on a per-packet basis. The packets are fully preserved when sent and received through the tunnel.</p>
<p id="rfc.section.5.2.p.2">This approach respects the end-to-end principle and thus does not introduce ossification. New transport protocols extensions can be negotiated in an end-to-end manner.</p>
<p id="rfc.section.5.2.p.3">This approach results in a higher encapsulation overhead, but it can be mitigated using advanced header compression techniques such as <a href="#I-D.ietf-lpwan-ipv6-static-context-hc" class="xref">[I-D.ietf-lpwan-ipv6-static-context-hc]</a>.</p>
<p id="rfc.section.5.2.p.4">Reliable Internet services require the QUIC connection to adapt, i.e. to transport their packets in an unreliable manner. Layering reliable transport protocols leads to the well-known meltdown problem in which the retransmissions mechanism of the different layers can severerly interfere with each other.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#one-to-one" id="one-to-one">One-to-One QUIC tunnel connection</a>
</h1>
<p id="rfc.section.5.3.p.1">The simplest approach when conveying an Internet service over QUIC would be to map a single connection to a single QUIC connection. This approach does not take advantage of the multiples streams feature of QUIC.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#n-to-one" id="n-to-one">N-to-One QUIC tunnel connection</a>
</h1>
<p id="rfc.section.5.4.p.1">When a client is using many Internet services through the QUIC tunnel, one could convey several of them inside a single QUIC connection. By leveraging the multiple streams feature of QUIC, this approach reduces the fixed cost of establishing and using a QUIC connection.</p>
<p id="rfc.section.5.4.p.2">Moreover, bundling several Internet connections inside a QUIC connection provides a more global point of view on the client network performances. It allows to take more informed decisions during packet scheduling or congestion control.</p>
<p id="rfc.section.5.4.p.3">TODO(mp): The preceding paragraph is not clear</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#tunneling-methods" id="tunneling-methods">Tunneling methods</a>
</h1>
<p id="rfc.section.6.p.1">Internet services rely on several protocols. In this section we present methods to tunnel the most ubiquitous ones.</p>
<p id="rfc.section.6.p.2">QUIC version 1 provides reliable and in-order bytestreams in the form of QUIC streams, which can be either unidirectional or bidirectional. An alternative view of QUIC unidirectional streams is an elastic message. The loss of a QUIC packet containing QUIC streams triggers a retransmission. This added complexity is un-needed in the case of a QUIC tunnel.</p>
<p id="rfc.section.6.p.3">We propose to use a lighter abstraction to convey Internet packets. The DATAGRAM extensions <a href="#I-D.pauly-quic-datagram" class="xref">[I-D.pauly-quic-datagram]</a> provide a datagram mode for QUIC.  DATAGRAM frames are simple messages that must fit the size of a QUIC packet.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#transport-layer-tunneling" id="transport-layer-tunneling">Transport layer tunneling</a>
</h1>
<p id="rfc.section.6.1.p.1">We choose to encapsulate the Internet services at the transport layer and not at the network layer. IP Options are seldom used today and thus maintaining end-to-end IP connectivity is not addressed by this document.</p>
<p id="rfc.section.6.1.p.2">IP datagrams can be created by the QUIC tunnel when receiving traffic from its peer. We propose to use the following flow header to exchange the required information to create the correct IP datagrams, and in turn to forward the received traffic to the correct peer, we propose to use the following flow header.</p>
<div id="rfc.figure.1"></div>
<div id="quic-tunnel-flow-header"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Flow ID (i)                        ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                  Destination IP Address (128)                 |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Destination Port (16)     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 1: QUIC Tunnel Flow Header</p>
<p id="rfc.section.6.1.p.3">The Flow Header associates a given ID with a destination address and port.  Mechanisms for exchanging and using the Flow Header are detailed in the following sub-sections on a per-protocol basis.</p>
<p id="rfc.section.6.1.p.4">The address is an IPv6 address. IPv4 addresses can be encoded as defined in TODO.</p>
<p id="rfc.section.6.1.p.5">TODO(mp): What is the implication of not maintaining IP connectivity, with for instance FTP or others ?</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#tunneling-tcp-connections" id="tunneling-tcp-connections">Tunneling TCP connections</a>
</h1>
<p id="rfc.section.6.2.p.1">TCP is a connection-oriented transport protocol. We consider two approaches for tunneling TCP connections. The first is to terminate and map a given TCP connection to a QUIC stream. The second is to convey the TCP segments as is and keep its connection end-to-end.</p>
<h1 id="rfc.section.6.2.1">
<a href="#rfc.section.6.2.1">6.2.1.</a> <a href="#tcp-to-quic-stream-mapping" id="tcp-to-quic-stream-mapping">TCP to QUIC stream mapping</a>
</h1>
<p id="rfc.section.6.2.1.p.1">We propose a TCP connection to QUIC stream mapping when considering the tunneling of TCP at the connection level.</p>
<div id="rfc.figure.2"></div>
<div id="tcp-proxy-conn"></div>
<pre>
Client          QUIC Tunnel          QUIC Tunnel          Server
     -----------&gt;
         SYN
     &lt;-----------
        SYN+ACK
     -----------&gt;
       ACK, Req           ===========&gt;
     &lt;-----------           Initial            -----------&gt;
         ACK            0-RTT[F.Hdr,Req]           SYN
                                               &lt;-----------
                                                  SYN+ACK
                                               -----------&gt;
                                                 ACK, Req
                                               &lt;-----------
                          &lt;===========             Resp
                           1-RTT[Resp]
     &lt;---------
        Resp

------- TCP                                        ======== QUIC
</pre>
<p class="figure">Figure 2: Establishing a new QUIC tunnel connection when proxying a request/response TCP connection</p>
<p><a href="#tcp-proxy-conn" class="xref">Figure 2</a> illustrates how a new TCP connection is conveyed inside a QUIC tunnel. The TCP connection is terminated at the entrance of the tunnel. A new TCP connection is created at its exit. A Flow Header is placed at the start of the stream. Then the TCP connection bytestream is carried over a QUIC stream.</p>
<div id="rfc.figure.3"></div>
<div id="tcp-proxy-stream"></div>
<pre>
+------------------+-------------------------+
|        TCP       |      QUIC Stream        |
+------------------+-------------------------+
| SYN received     | Open Stream, send F.Hdr |
| FIN received     | Send Stream FIN         |
| RST received     | Send STOP_SENDING       |
|                  | Send RESET_STREAM       |
| Data received    | Send Stream data        |
+------------------+-------------------------+

+-------------------------------+------------+
|         QUIC Stream           |    TCP     |
+-------------------------------+------------+
| Stream opened, F.Hdr received | Send SYN   |
| Stream FIN received           | Send FIN   |
| STOP_SENDING received         | Send RST   |
| RESET_STREAM received         | Send RST   |
| Stream data received          | Send data  |
+-------------------------------+------------+

</pre>
<p class="figure">Figure 3: TCP connection to QUIC stream mapping</p>
<p id="rfc.section.6.2.1.p.3">Actions and events of the TCP state machine are mapped to the QUIC stream state machine as illustrated in <a href="#tcp-proxy-stream" class="xref">Figure 3</a>.</p>
<p id="rfc.section.6.2.1.p.4">The QUIC stream-level flow control can be tuned to match the terminated TCP connection receive window size, so that no excessive amount of data is buffered inside the tunnel.</p>
<p id="rfc.section.6.2.1.p.5">A timeout can be associated with a given mapped QUIC stream for its associated state to expire when the TCP connection is inactive for a long period of time.</p>
<h1 id="rfc.section.6.2.2">
<a href="#rfc.section.6.2.2">6.2.2.</a> <a href="#tcp-segments-tunneling" id="tcp-segments-tunneling">TCP segments tunneling</a>
</h1>
<p id="rfc.section.6.2.2.p.1">We propose to tunnel TCP segments inside DATAGRAM frames.  When segments of a new TCP connection are conveyed, the QUIC tunnel must send a Flow Header to its peer for it to correctly handle the segments.</p>
<p id="rfc.section.6.2.2.p.2">Two approaches can be taken. In the first one, the header can be placed before the DATAGRAM payload. Then, when the DATAGRAM is acknowledged, subsequent DATAGRAMs from this flow can replace the Flow Header used with its Flow ID solely.  The disadvantage is that the MTU available is lowered first, then raised upon Flow Header acknowledgment.</p>
<p id="rfc.section.6.2.2.p.3">In the second approach, TCP segments that are sent before acknowledgement of a Flow Header are conveyed in unidirectional streams. The Flow Header is placed at the beginning of the stream. Each stream can be reset as soon as its content as been transmitted in order to avoid retransmissions. Once a stream has been fully acknowledged, the QUIC tunnel can switch to transmitting DATAGRAMs with the corresponding Flow ID. This does not introduce MTU fluctuations but is more costly for the QUIC tunnel.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#tunneling-udp-flows" id="tunneling-udp-flows">Tunneling UDP flows</a>
</h1>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#tunneling-quic-connections" id="tunneling-quic-connections">Tunneling QUIC connections</a>
</h1>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> <a href="#tunneling-ip-flows" id="tunneling-ip-flows">Tunneling IP flows</a>
</h1>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">TODO Security</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This document has no IANA actions.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-lpwan-ipv6-static-context-hc">[I-D.ietf-lpwan-ipv6-static-context-hc]</b></td>
<td class="top">
<a>Minaburo, A.</a>, <a>Toutain, L.</a>, <a>Gomez, C.</a>, <a>Barthel, D.</a> and <a>J. Zuniga</a>, "<a href="https://tools.ietf.org/html/draft-ietf-lpwan-ipv6-static-context-hc-21">Static Context Header Compression (SCHC) and fragmentation for LPWAN, application to UDP/IPv6</a>", Internet-Draft draft-ietf-lpwan-ipv6-static-context-hc-21, July 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.pauly-quic-datagram">[I-D.pauly-quic-datagram]</b></td>
<td class="top">
<a>Pauly, T.</a>, <a>Kinnear, E.</a> and <a>D. Schinazi</a>, "<a href="https://tools.ietf.org/html/draft-pauly-quic-datagram-03">An Unreliable Datagram Extension to QUIC</a>", Internet-Draft draft-pauly-quic-datagram-03, July 2019.</td>
</tr>
</tbody></table>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.A.p.1">TODO acknowledge.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maxime Piraux</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Piraux</span>
	  </span>
	</span>
	<span class="org vcardline">UCLouvain</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maxime.piraux@uclouvain.be">maxime.piraux@uclouvain.be</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Olivier Bonaventure</span> 
	  <span class="n hidden">
		<span class="family-name">Bonaventure</span>
	  </span>
	</span>
	<span class="org vcardline">UCLouvain</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:olivier.bonaventure@uclouvain.be">olivier.bonaventure@uclouvain.be</a></span>

  </address>
</div>

</body>
</html>

